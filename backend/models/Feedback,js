const admin = require("../config/firebase");
const db = admin.firestore(); 

const Feedback = {
  async create(feedbackData) {
    const feedback = {
      feedbackId: feedbackData.feedbackId || db.collection('feedback').doc().id,
      bookingId: feedbackData.bookingId,
      fromUserId: feedbackData.fromUserId,
      toUserId: feedbackData.toUserId,
      rating: feedbackData.rating || 0,
      comment: feedbackData.comment || '',
      createdAt: admin.firestore.Timestamp.now()
    };
    await db.collection('feedback').doc(feedback.feedbackId).set(feedback);
    return feedback;
  },
  async get(feedbackId) {
    const doc = await db.collection('feedback').doc(feedbackId).get();
    if (!doc.exists) throw new Error('Feedback not found');
    return doc.data();
  },
  async update(feedbackId, updates) {
    const updated = { ...updates, updatedAt: admin.firestore.Timestamp.now() };
    await db.collection('feedback').doc(feedbackId).update(updated);
    return updated;
  }
};

module.exports = Feedback;